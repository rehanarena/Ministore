<div class="row">
  <!-- Update Profile Form -->
  <div class="col-md-6">
    <form id="update-form" action="/user/profile" method="POST">
      <div class="card bg-light rounded-3 p-4 mb-4">
        <h4 class="card-title mb-4">Update Profile</h4>
        <div class="mb-3">
          <label class="form-label" for="account-fn">First Name</label>
          <input name="firstName" class="form-control" type="text" id="account-fn" value="<%- user.firstName %>">
          <small></small>
        </div>
        <div class="mb-3">
          <label class="form-label" for="account-ln">Last Name</label>
          <input name="lastName" class="form-control" type="text" id="account-ln" value="<%- user.lastName %>">
          <small></small>
        </div>
        <div class="mb-3">
          <label class="form-label" for="account-email">Email Address</label>
          <input class="form-control" type="email" id="account-email" value="<%- user.email %>" disabled>
        </div>
        <div class="mb-3">
          <label class="form-label" for="account-phone">Phone Number</label>
          <input name="phone" class="form-control" type="text" id="account-phone" value="<%- user.phone %>" placeholder="9778877665" required>
          <small></small>
        </div>
        <hr class="mt-4 mb-3">
        <div class="d-grid">
          <button class="btn btn-success" type="submit">Save Profile</button>
        </div>
      </div>
    </form>
  </div>

  <!-- Change Password Form -->
  <div class="col-md-6">
    <form action="/user/reset-password" method="POST" id="reset-password-form">
      <div class="card bg-light rounded-3 p-4 mb-4">
        <h4 class="card-title mb-4">Change Password</h4>
        <div class="mb-3">
          <label class="form-label" for="oldPassword">Old Password</label>
          <div class="input-group">
            <input type="password" class="form-control" id="oldPassword" name="oldPassword" placeholder="Old Password">
            <button class="btn btn-outline-secondary" type="button" id="toggleOldPassword">
              <i class="bi bi-eye-slash"></i>
            </button>
          </div>
          <small></small>
        </div>
        <div class="mb-3">
          <label class="form-label" for="newPassword">New Password</label>
          <div class="input-group">
            <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="New Password">
            <button class="btn btn-outline-secondary" type="button" id="toggleNewPassword">
              <i class="bi bi-eye-slash"></i>
            </button>
          </div>
          <small></small>
        </div>
        <div class="mb-3">
          <label class="form-label" for="confirmNewPassword">Confirm New Password</label>
          <div class="input-group">
            <input type="password" class="form-control" id="confirmNewPassword" name="confirmNewPassword" placeholder="Confirm New Password">
            <button class="btn btn-outline-secondary" type="button" id="toggleNewPasswordConfirm">
              <i class="bi bi-eye-slash"></i>
            </button>
          </div>
          <small></small>
        </div>
        <hr class="mt-4 mb-3">
        <div class="d-grid">
          <button class="btn btn-success" type="submit">Change Password</button>
        </div>
      </div>
    </form>
  </div>
</div>






























<!-- Hero Section-->
<section class="hero">
  <div class="container">
    <div class="row">
      <%- include('../partials/user/sidebar.ejs') %>
        <div class="col-lg-8">
          <div class="d-flex flex-column">
            <% orderProducts.forEach(item=> { %>
              <div class="card mb-3" style="max-width: 540px;">
                <div class="row g-0">
                  <div class="col-md-4">
                    <img src="/uploads/cropped/<%- item.product_id.images.image1 %>"
                      class="img-fluid img-thumbnail rounded-start" alt="Product Image">
                  </div>
                  <div class="col-md-8">
                    <div class="card-body">
                      <h5 class="card-title"><%- item.product_id.product_name %></h5>
                      <p class="card-text"><span class="fw-bold">Price: <span class="text-muted"><%- item.price
                              %></span></span></p>
                      <p class="card-text"><span class="fw-bold">Quantity: <span class="text-muted"><%-
                              item.quantity %></span></span></p>
                      <p class="card-text"><span class="fw-bold">Item Total: <span class="text-muted"><%-
                              item.total_amount %></span></span></p>
                      <p class="card-text"><small class="text-body-secondary">Last updated <%-
                            orderDetails.updatedAt.toDateString() %></small></p>
                      <p class="card-text"><small class="text-body-secondary fs-2"><span
                            class="badge bg-success"><%- item.status %></span></small></p>
                    </div>
                    <div class="d-grid gap-2 flex-row mx-auto">

                      <button type="button" class="btn btn-outline-warning"
                        onclick="cancelOrder('<%- orderDetails._id %>', '<%- item.product_id._id%>')">Cancel
                        Order</button>

                    </div>

                  </div>
                </div>
              </div>
              <% }) %>
          </div>
        </div>
    </div>
  </div>
</section>
cancelOrder js function (script tag wasn't closed)

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
<script defer>
const cancelOrder = async (orderId, itemId) => {
const confirmed = await Swal.fire({
  title: "Are you sure?",
  text: "You want to cancel this order.",
  icon: "warning",
  showCancelButton: true,
  confirmButtonText: "Yes, cancel!",
  cancelButtonText: "No, keep it!",
  reverseButtons: true,
});

if (confirmed.isConfirmed) {
  try {
    const response = await fetch(`/user/cancel-order/${orderId}/${itemId}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    });
    console.log(response);
    const data = await response.json(); // Parse the response as JSON
    console.log(data);
    if (response.ok) {
      Swal.fire({
        title: "Success!",
        text: data.message, // Use the message from the backend
        icon: "success",
        timer: 1500,
      }).then(() => {
        location.reload();
      });
    } else {
      Swal.fire({
        title: "Error!",
        text: data.message || "Something went wrong.", // Use the message from the backend if available
        icon: "error",
        timer: 1500,
      });
    }
  } catch (error) {
    console.error(error);
    Swal.fire({
      title: "Error!",
      text: "Something went wrong.",
      icon: "error",
      timer: 1500,
    });
  }
}
}
</script>





getOrderDetails: async (req, res) => {
  const orderId = req.params.id;

  try {

    const orderDetails = await Order.findById(orderId)
      .populate("items.product_id")
      .populate("customer_id")
      .populate("address");

    res.render("admin/orders/viewOrder", {
      layout,
      orderDetails,
      
    });
  } catch (error) {
    console.log(error);
  }
},































<div class="row">
  <!-- product-->
  <% if ( products !== 'undefined' && products?.length > 0) { %>
    <% products?.forEach(element => { %>

    <div class="col-xl-4 col-6">
      <div class="product">
        <div class="product-image">
          <% if (element.onOffer) { %>
            <div class="ribbon ribbon-info">On offer <%- element.offerDiscountRate %>%</div>
          <% } %>
          <!-- <div class="ribbon ribbon-info">Fresh</div> -->
          <img class="img-fluid" src="/uploads/product-images/<%- element.primary_image.name %>" alt="product" />
          <div class="product-hover-overlay">
            <a class="product-hover-overlay-link" href="/shop/product/<%- element._id %>"></a>
            <div class="product-hover-overlay-buttons">
              <!-- <button class="btn btn-outline-primary btn-product-left d-none d-sm-inline-block" <% if (element.variants && element.variants.length >0) { %> onclick="addToCart('<%- element?._id %>','<%- element.variants[0]._id %>','<%- element.variants[0].color %>', '<%- element.variants[0].size %>')" <% } %>>
                <i class="bi bi-cart-fill fs-5"></i>
              </button> -->
              <a class="btn btn-dark btn-buy" href="/shop/product/<%- element._id %>">
                <i class="bi bi-search"></i>
                <span class="btn-buy-label ms-2">View</span>
              </a>
              <button id="wishlist-<%- element._id %>" class="btn btn-outline-danger btn-product-right d-none d-sm-inline-block justify-content-center" onclick="addToWishlist('<%- element._id %>')">
                <i class="bi bi-heart fs-5"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="py-2">
          <p class="text-muted text-sm mb-1"><%- element.brand_name %></p>
          <h3 class="h6 text-uppercase mb-1">
            <a class="text-dark" href="#"><%- element.product_name %></a>
          </h3>
          <div class="row g-2">
            <% if (!element.onOffer) { %>
              <span class="text-muted col">₹<%- element.sellingPrice %></span>
              <span class="text-muted col"><del>₹<%- element.actualPrice %></del></span>
            <% } else { %>   
                <span class="text-muted col">₹<%- element.offerDiscountPrice %></span>
                <span class="text-muted col"><del>₹<%- element.sellingPrice %></del></span>
            <% } %>
            <br />
            <!-- <span class="fw-bold h5 col">Size:
              <span class="fw-normal text-muted"><%- element.variants[0].size.value %></span></span> -->
          </div>
        </div>
      </div>
    </div>
    <% }) %>

  <% } else { %>
    
    <div class="col-xl-4 col-6">
      <div class="product">
        <!-- <div class="product-image">
          <div class="ribbon ribbon-info">No products found</div>
        </div> -->
        <div class="py-2">
          <p class="text-muted display-3 text-warning text-sm mb-1">No products found</p>
        </div>
      </div>
    </div>

  <% } %>
  <!-- /product-->
</div>

</div>

/uploads/cropped/<%- element.images.image1 %>