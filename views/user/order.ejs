<section>
  <div class="container">
     <!-- Breadcrumbs -->
     <ol class="breadcrumb justify-content-center">
       <li class="breadcrumb-item"><a href="/">Home</a></li>
       <li class="breadcrumb-item"><a href="/user/profile">My Account</a></li>
       <li class="breadcrumb-item"><a href="/user/orders">Orders</a></li>
     </ol>
     <!-- Hero Content-->
     <div class="hero-content pb-5 text-center">
       <h1 class="hero-heading h2">
         Order <span class="text-muted">#<%- orderDetails._id %></span>
       </h1>
     </div>
     <!-- Hero Section-->
     <section class="hero">
       <div class="container">
         <div class="row">
           <%- include('../partials/user/sidebar.ejs') %>
           <div class="col-lg-8">
             <div class="d-flex flex-column">
               <% orderProducts.forEach(item => { %>
                 <div class="card mb-3" style="max-width: 540px;">
                  <div class="row g-0">
                     <div class="col-md-4">
                       <img src="/uploads/cropped/<%- item.product_id.images.image1 %>" class="img-fluid img-thumbnail rounded-start" alt="Product Image">
                     </div>
                     <div class="col-md-8">
                       <div class="card-body">
                         <h5 class="card-title"><%- item.product_id.product_name %></h5>
                         <p class="card-text"><span class="fw-bold">Price: <span class="text-muted"><%- item.price %></span></span></p>
                         <p class="card-text"><span class="fw-bold">Quantity: <span class="text-muted"><%- item.quantity %></span></span></p>
                         <p class="card-text"><span class="fw-bold">Item Total: <span class="text-muted"><%- item.itemTotal %></span></span></p>
                         <p class="card-text"><small class="text-body-secondary">Last updated <%- orderDetails.updatedAt.toDateString() %></small></p>
                         <p class="card-text"><small class="text-body-secondary fs-2"><span class="badge bg-success"><%- item.status %></span></small></p>
                       </div>
                       <div class="d-grid gap-2 flex-row mx-auto">
                      
                        <button type="button" class="btn btn-outline-warning" onclick="cancelOrder('<%- orderDetails._id %>')">Cancel Order</button>
                        
                       </div>
                       
                     </div>
                  </div>
                 </div>
               <% }) %>
             </div>
           </div>
         </div>
       </div>
     </section>
  </div>
 </section>




 <script defer>
  const cancelOrder = async (orderId, itemId) => {
    const confirmed = await Swal.fire({
      title: "Are you sure?",
      text: "You want to cancel this order.",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Yes, cancel!",
      cancelButtonText: "No, keep it!",
      reverseButtons: true,
    });

    if (confirmed.isConfirmed) {
      try {
        const response = await fetch(`/user/cancel-order/${orderId}/${itemId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        });
        console.log(response);
        const data = await response.json(); // Parse the response as JSON
        console.log(data);
        if (response.ok) {
          Swal.fire({
            title: "Success!",
            text: data.message, // Use the message from the backend
            icon: "success",
            timer: 1500,
          }).then(() => {
            location.reload();
          });
        } else {
          Swal.fire({
            title: "Error!",
            text: data.message || "Something went wrong.", // Use the message from the backend if available
            icon: "error",
            timer: 1500,
          });
        }
      } catch (error) {
        console.error(error);
        Swal.fire({
          title: "Error!",
          text: "Something went wrong.",
          icon: "error",
          timer: 1500,
        });
      }
    }
  }
 